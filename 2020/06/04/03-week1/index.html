<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width initial-scale=1">

  <title>AI for Medical Treatment - week1</title>
  <meta name="description" content="Contents of third course of specialization">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://youngwonseo.github.io/2020/06/04/03-week1/">
  <link rel="alternate" type="application/atom+xml" title="Youngon.Seo" href="https://youngwonseo.github.io/feed.xml" />
</head>

  <body>
    

<div class="header-container" id="header-container">

<!-- Site navigation -->
  <nav class="site-nav">
    <div class="trigger">
      
        
        <a class="page-link" href="/about/">About</a>
        
      
        
        <a class="page-link" href="/archive/">Archive</a>
        
      
        
      
        
      
        
        <a class="page-link" href="/projects/">Projects</a>
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
      <a class="page-link" href="/feed.xml">RSS</a>
      <a class="twitter page-link" href="https://twitter.com/fffabs"><span class="icon-twitter"></span></a>
      <a class="facebook page-link" href="https://www.facebook.com/fffabs"><span class="icon-facebook"></span></a>
    </div>
  </nav>

  <!-- The title of the site -->
  <header class="site-header">
    <a href="/">
      <div class="avatar">
        <img src="/assets/images/avatar.png" />
      </div>
    </a>
    <!-- <a class="site-title" href="/">Youngon.Seo</a> -->
  </header>

</div>

      <div class="wrapper">
        <div class="page-content">
          <div class="post">

  <header class="post-header">
    <h1 class="post-title">AI for Medical Treatment - week1</h1>
    <p class="post-meta">June 4, 2020 • Youngwon Seo</p>
  </header>

  <!-- Beginning Twitter sharing Large button -->
  <!-- <a class="twitter-share-button" href="https://twitter.com/share"
  data-related="twitterdev"
  data-size="large"
  data-count="horizontal">
  Tweet
  </a> -->
  <!-- End of Twitter sharing button -->

  <!-- Facebook -->
  

  <article class="post-content">
    <p>Contents of third course of specialization</p>

<ul>
  <li>week1
    <ul>
      <li>how to build any valid models for SVT treatment effects.</li>
    </ul>
  </li>
  <li>week2
    <ul>
      <li>question-answering application using BERT.</li>
      <li>how to automatically have a machine read radiology reports and extract the mentions of diseases from those reports(get to that lable data from unstructured text in radiology reports).</li>
    </ul>
  </li>
  <li>week3
    <ul>
      <li>how to interpret machine learning models.</li>
      <li>look at techniques that make use of all of that unstructured data.</li>
      <li>methods that can use to determind how different features are contributing to a model’s decision.</li>
    </ul>
  </li>
</ul>

<h2 id="randomized-control-trials">Randomized Control Trials</h2>

<h3 id="absolute-risk-reduction-arr">Absolute Risk Reduction (ARR)</h3>
<p>treatment
control</p>

<p><img src="/public/medicine/03/01/03-01.png" alt="" /></p>

<ul>
  <li>각그룹에서 heart attack이 2%, 5%로 발생</li>
  <li>treatment effect가 0.02 absolute rick(AR)과 0.05AR</li>
  <li>0.03 absolute risk reduction (ARR)로 표현가능
    <ul>
      <li>control그룹의 AR - treatment그룹의 AR</li>
      <li>0.05 - 0.02 = 0.03</li>
    </ul>
  </li>
</ul>

<h3 id="randomized-control-trials-rct">Randomized Control Trials (RCT)</h3>
<ul>
  <li>absolute risk reduction은 알게 되었지만 treatment그룹과 control그룹에 지정된 환자의 나이 및 건강상태도 중요함</li>
  <li>예로들어 treatment그룹이 대부분 젊고 건강상태가 양호한 환자들로 구성되어있다면 treatment그룹의 heart attack에 대한 AR가 현저히 낮게 측정된 것임</li>
</ul>

<p><img src="/public/medicine/03/01/03-02.png" alt="" /></p>
<ul>
  <li>각 그룹의 평균, 표준편차 등의 특성을 이용해 두 그룹이 비슷하다는것을 보일수 있음</li>
  <li>ARR이 0.03이고 p-value가 0.001일 경우 치료가 실제로 효과를 발휘할 경우 0.03 이상의 위험 차이를 관찰 할 확률은 0.1 % 미만입니다.</li>
  <li>p-value는 낮을수록 효과가</li>
</ul>

<h2 id="average-treatment-effect">Average Treatment Effect</h2>
<h3 id="causal-inference">Causal inference</h3>
<ul>
  <li>treatment 유무에 대한 결과(outcome)에 따라 적용여부를 판단
    <ul>
      <li>treatment 적용으로 인해 heart attack과 같은 risk가 감소하면 treatment를 적용</li>
    </ul>
  </li>
</ul>

<p><img src="/public/medicine/03/01/03-03.png" alt="" /></p>
<ul>
  <li>위 표 처럼 환자에 따라 treatment 유무에 따른 결과를 기반으로 Benefit/No effect/Harm 으로 구분</li>
  <li>위 표는 아래의 표와 같이 표현가능</li>
</ul>

<p><img src="/public/medicine/03/01/03-04.png" alt="" /></p>
<ul>
  <li>Y(1) 은 treatment적용, Y(0)은 treatment 미적용을 의미</li>
  <li>이것을 Neyman-Rubin causal model이라 함</li>
</ul>

<p><img src="/public/medicine/03/01/03-05.png" alt="" /></p>
<ul>
  <li>Y(1) - Y(0) 의 평균을 Average Treatment Effect라 함</li>
</ul>

<h3 id="average-treatment-effect-1">Average treatment effect</h3>
<ul>
  <li>현실에서는 treatment 유무에 대한 결과를 얻을수 없음</li>
  <li>이를 fundamental problem of causal inference라 함</li>
</ul>

<p><img src="/public/medicine/03/01/03-06.png" alt="" /></p>
<ul>
  <li>현실에서는 위와 같이 treatment의 유 또는 무에 대한 결과만 관찰가능</li>
  <li>실제 적용여부에 대한 결과를 observed/factual 이라하고 미적용의 알수없는 결과를 unobserved/conuterfactual이라함</li>
</ul>

<p><img src="/public/medicine/03/01/03-07.png" alt="" /></p>
<ul>
  <li>W는 treatment 적용 여부</li>
</ul>

<p><img src="/public/medicine/03/01/03-08.png" alt="" /></p>
<ul>
  <li>treatment 적용여부(W)에 따라 평균을 계산</li>
  <li>randomized controlled trials 안에서</li>
  <li>0.32 - 0.51 = -0.19
    <ul>
      <li>average risk reduction (ARR) = 0.19 (19%)</li>
      <li>average treatment effect (ATE)= -0.19</li>
    </ul>
  </li>
</ul>

<h3 id="conditional-average-treatment-effect">Conditional average treatment effect</h3>
<ul>
  <li>이전에 ATE를 계산함으로써 평균적인 effect를 구할수 있었음</li>
  <li>그럼 좀더 개별적인 treatment의 effect를 구하려면 어떻게 해야할까?</li>
</ul>

<p><img src="/public/medicine/03/01/03-09.png" alt="" /></p>
<ul>
  <li>나이가 56세인 환자에 대한 effect를 계산하기 위해 같은 나이의 환자에 대한 ATE를 계산</li>
  <li>이처럼 환자의 특정 feature값에 대응되는 effect결과를 Conditional aveage treatment effect(CATE)라 함</li>
  <li>하지만 위처럼 매우 적은 샘플의 수로 계산할 경우, 또는 데이터가 한쪽(treatment에 대해)만 존재하는 경우 데이터의 편향을 따름</li>
  <li>이런 경우 환자가 가지고 있는 각 feature간의 관계를 통해 estimate를 얻을 수 있음</li>
</ul>

<p><img src="/public/medicine/03/01/03-10.png" alt="" /></p>
<ul>
  <li>x는 condition을 의미
    <ul>
      <li>age가 56인 경우 x = [56]</li>
      <li>age가 56, BP가 130인 경우 x = [56,130]</li>
    </ul>
  </li>
  <li>각 조건에 대해 treatment에 따라 treatment response function과 control response function으로 구분</li>
</ul>

<h3 id="t-learner">T-Learner</h3>
<p><img src="/public/medicine/03/01/03-11.png" alt="" /></p>
<ul>
  <li>treatment response function(μ1)과 control reonse function(μ0)은 base learner를 통해 학습가능</li>
  <li>age, bp가 인풋에 해당하고 y가 아웃풋에 해당</li>
  <li>training data와 validation data로 학습</li>
</ul>

<p><img src="/public/medicine/03/01/03-12.png" alt="" /></p>
<ul>
  <li>base learner로 decision tree를 선택한 경우는 다음과 같음</li>
  <li>age=56, BP=130인 환자에 대한 risk를 계산
    <ul>
      <li>각 feature에 대한 위험도를 의미하는 노드로 결과를 계산</li>
      <li>μ1에 대한 트리의 노드(age 56에 해당)를 통해 risk score를 0.21으로 판단</li>
      <li>μ0에 대한 트리의 노드(BP 130에 해당)를 통해 risk score를 0.45로 판단</li>
      <li>μ1 - μ0 = -0.24</li>
      <li>이를 Two-Tree method 또는 T-learner라고 함</li>
    </ul>
  </li>
</ul>

<h3 id="s-learner">S-Learner</h3>
<ul>
  <li>하나의 모델로 treatment가 1인 경우와 0인경우의 risk를 계산하는것을 Single-Tree method 또는 S-learner라고 함
<img src="/public/medicine/03/01/03-13.png" alt="" />
<img src="/public/medicine/03/01/03-14.png" alt="" /></li>
  <li>age=56, BP=130인 환자에 대한 risk를 계산
    <ul>
      <li>각 feature에 대한 값과 teatment 여부에 대한 판단을 하나의 모델을 통해 계산</li>
      <li>0.40 - 0.50 = -0.10</li>
    </ul>
  </li>
  <li>모델에 treatment 여부에 따른 노드가 없을 경우 s1-s0=0, s1과 s0은 같은 값이 됨</li>
  <li>T-Learner의 경우 각 모델이 전체 데이터의 반씩 할당되어 학습되기 때문에 학습을 위해 보다 적은 데이터로 밖에 학습시킬수 없음</li>
  <li>T-Learner와 S-Learner는 covariates를 사용한 risk를 예측하는 간단한 방법의 일부</li>
</ul>

<h2 id="individualized-treatment-effect">Individualized Treatment Effect</h2>
<h3 id="evaluate-individualized-treatment-effect">Evaluate individualized treatment effect</h3>
<p><img src="/public/medicine/03/01/03-15.png" alt="" /></p>
<ul>
  <li>W=1이므로 Y(1)인 treatment 적용일 경우 0의 결과를 보임</li>
  <li>이때 Y(0)은 어떻게 구할것인가?</li>
  <li>여기에는 두가지 방법이 있는데 비슷한 feature를 가진 환자의 Y(0)를 구하거나 비슷한 ITE 를 가진 환자의 Y(0)을 계산하는것</li>
</ul>

<p><img src="/public/medicine/03/01/03-16.png" alt="" /></p>
<ul>
  <li>Matched Pair란 W가 서로 다른 두 쌍을 의미함</li>
  <li>ITE estimate의 평균을 사용</li>
</ul>

<p><img src="/public/medicine/03/01/03-17.png" alt="" /></p>
<ul>
  <li>각 pair에 대한 Y(1) - Y(0)의 결과에 의해 Harm/Benefit/No Effect를 판단</li>
</ul>

<h3 id="c-for-benefit">C-for-benefit</h3>

<ul>
  <li>각 pair의 결과를 사용해 C-for-benefit을 계산(C-Index와 유사)</li>
  <li>각 pair에 대한 estimate와 outcome을 비교해 다음과 같이 판단
    <ul>
      <li>Concordant Pair : estimate와 outcome가 한쪽이 더 높은 경우</li>
      <li>Concordant Pair : estimate가 높은 쪽이 outcome은 낮은 경우</li>
      <li>Risk Tie : estimate와 outcome이 동인한 경우</li>
      <li>Tie in Outcome : outcome은 동인한ㄷ네 estimate가 다른경우</li>
      <li>Permissible : outcome이 서로 다른 경우</li>
    </ul>
  </li>
</ul>

<p><img src="/public/medicine/03/03-18.png" alt="" /></p>

<h3 id="c-for-benefit-calculation">C-for-benefit calculation</h3>

<p><img src="/public/medicine/03/01/03-19.png" alt="" /></p>
<ul>
  <li>위와 같은 pair들이 존재할때 C-index를 계산하면 다음과 같음
    <ul>
      <li>Permissible Pairs에 속하는, 즉 outcome이 다른 pair는 AB, AC, AD, BC, BD (C와 D는 outcome이 같아서 아님)</li>
      <li>Concordant Pairs에 속하는, 즉 한쪽으로만 estimate와 outcome이 높은경우는 AB, AC, BC, BD</li>
      <li>Risk Ties에 속하는것, 즉 estimate와 outcome이 같은 경우는 없음</li>
    </ul>
  </li>
</ul>

<p><img src="/public/medicine/03/01/03-20.png" alt="" /></p>
<ul>
  <li>C-for-benefit을 계산하기 위해 주어진 데이터로 부터 먼저 C-index를 계산
    <ol>
      <li>W가 0, 1 즉 treatment여부에 따라 데이터를 분리(위 두개의 테이블)</li>
      <li>각 테이블을 ITE를 기반으로 정렬(오름차순)</li>
      <li>위에서 부터 각 순으로 Pair가 됨(YD는 Y의 차이, TE는 ITE의 평균)</li>
      <li>YD는 outcome을 의미하고 TE는 estimate를 의미</li>
    </ol>
  </li>
</ul>

<p><img src="/public/medicine/03/01/03-21.png" alt="" /></p>
<ul>
  <li>C-for-benefit의 의미
    <ul>
      <li>2개의 랜덤한 A,B pair에 대하여 A의 outcome과 estimate가 더 높으면 60%의 확률로 A가 더 치료가 잘될것으로 예측된다는것</li>
      <li>60%이라는 값은 S-Learner를 의미</li>
    </ul>
  </li>
</ul>

<h2 id="assignment">Assignment</h2>

<ul>
  <li>How to analyze data from a randomized control trial using both:
    <ul>
      <li>traditional statistical methods</li>
      <li>and the more recent machine learning techniques</li>
    </ul>
  </li>
  <li>Interpreting Multivariate Models
    <ul>
      <li>Quantifying treatment effect</li>
      <li>Calculating baseline risk</li>
      <li>Calculating predicted risk reduction</li>
    </ul>
  </li>
  <li>Evaluating Treatment Effect Models
    <ul>
      <li>Comparing predicted and empirical risk reductions</li>
      <li>Computing C-statistic-for-benefit</li>
    </ul>
  </li>
  <li>Interpreting ML models for Treatment Effect Estimation
    <ul>
      <li>Implement T-learner</li>
    </ul>
  </li>
</ul>


  </article>

  <hr>

  
    <div id="disqus_thread"></div>
<script>

/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
/*
var disqus_config = function () {
this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
*/
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = 'https://youngwonseo.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
                            
  
  <!-- <div class="question">
    <h2>Questions?</h2>
    <p>Have a question regarding the post above? <br />Or any of my designs?</p>
    <a class="twitter-follow-button"
    href="https://twitter.com/fffabs"
    data-show-count="true"
    data-size="large">
    Follow @fffabs
    </a>
    <script type="text/javascript">
    window.twttr = (function (d, s, id) {
      var t, js, fjs = d.getElementsByTagName(s)[0];
      if (d.getElementById(id)) return;
      js = d.createElement(s); js.id = id;
      js.src= "https://platform.twitter.com/widgets.js";
      fjs.parentNode.insertBefore(js, fjs);
      return window.twttr || (t = { _e: [], ready: function (f) { t._e.push(f) } });
    }(document, "script", "twitter-wjs"));
    </script>
  </div> -->

  <div class="related">
    <h2>Related</h2>
    
      <li><a href="/2020/10/09/image-resize/" title="파이썬 이미지 리사이즈">파이썬 이미지 리사이즈
       &nbsp; <span class="post-meta">October 09, 2020</span></a>
    
      <li><a href="/2020/09/22/class-activation-map/" title="Learning Deep Features for Discriminative Localization">Learning Deep Features for Discriminative Localization
       &nbsp; <span class="post-meta">September 22, 2020</span></a>
    
      <li><a href="/2020/09/21/network-in-network/" title="Network In Network">Network In Network
       &nbsp; <span class="post-meta">September 21, 2020</span></a>
    
  </div>

</div>

        </div>
        <footer class="site-footer">
<p class="small">YoungwonSeo &copy 2020
</p>
</footer>

    </div>

    <script src="//cdn.jsdelivr.net/headroomjs/0.5.0/headroom.min.js"></script>
    <script type="text/javascript">
      var el = document.querySelector(".header-container");
      var headroom  = new Headroom(el, {
        "offset": 205,
        "tolerance": 5
      });
      headroom.init();
    </script>


    <!-- Twitter Shizzle -->
    <!-- <script type="text/javascript">
    window.twttr = (function (d, s, id) {
      var t, js, fjs = d.getElementsByTagName(s)[0];
      if (d.getElementById(id)) return;
      js = d.createElement(s); js.id = id;
      js.src= "https://platform.twitter.com/widgets.js";
      fjs.parentNode.insertBefore(js, fjs);
      return window.twttr || (t = { _e: [], ready: function (f) { t._e.push(f) } });
    }(document, "script", "twitter-wjs"));
    </script> -->
    	<!-- Google Analytics -->
  <script>
		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
		
		ga('create', 'UA-78263144-1', 'auto');
		ga('send', 'pageview');
		</script>
		<!-- End Google Analytics -->
</header>


  </body>
</html>
