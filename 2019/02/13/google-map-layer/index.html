<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>
    
      구글맵에 레이어 표기하기 &middot; Youngwon Seo
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/assets/main.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Libre+Baskerville:400,400i,700">

  <!-- Favicon -->
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon-16x16.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png">
</head>

  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-118401942-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-118401942-1');
</script>

  <body>
    <nav class="nav">
      <div class="nav-container">
        <a href="/">
          <h2 class="nav-title">Youngwon Seo</h2>
        </a>
        <ul>
          <li><a href="/about">About</a></li>
          <li><a href="/">Posts</a></li>
          <li><a href="/study"/>Study</a></li>
          <li><a href="/ml"/>Machine Learning</a></li>
          <li><a href="/people"/>People</a></li>
          <!-- <li><a href="/spring"/>Spring</a></li>
          <li><a href="/deeplearning"/>Deeplearning</a></li> -->
        </ul>
    </div>
  </nav>

    <main>
      <div class="post">
  <div class="post-info">
    <span>Written by</span>
    
        Youngwon Seo
    

    
      <br>
      <span>on&nbsp;</span><time datetime="2019-02-13 00:00:00 +0900">February 13, 2019</time>
    
  </div>

  <h1 class="post-title">구글맵에 레이어 표기하기</h1>
  <div class="post-line"></div>

  <h2 id="1-background">1. background</h2>
<ul>
  <li>웹 기반 지도에 시도/구/동 단위의 정보를 시각화할 필요가 생겼다.</li>
  <li>솔루션 구매할 비용은 없다. 그러므로 일단 만들어야된다.</li>
  <li>지도 본연의 interactive한 요소들이 필요하여 D3나 Echart등의 시각화에 도구대신 구글맵을 사용한다(시각화도구를 사용하면 레이어를 보다 쉽게 그릴수 있다).</li>
  <li>초기 TopoJSON으로 개발한 모듈이 존재했지만 TopoJson이 아닌 순수 구글맵라이브러리가 필요했다. 이유는 같이 일하던 친구가 TopoJSON이 마음에 안들다는 식으로 말을했다.</li>
  <li>구글에서는 GeoJSON이 적용된다고 하니, 한국지리정보를 포함하고 있는 GeoJSON를 구하거나 만들면된다.</li>
  <li>구글의 GeoJSON을 사용하기 위해서는 GeoJSON의 Type이 Topology가 아닌 FeatureCollection가 되어야 한다는 것을 명심하자(왜 그런것인지는 모르겠다).</li>
</ul>

<h2 id="2-목표">2. 목표</h2>
<ul>
  <li>구글맵에 레이어를 출력하고 레이어별 이벤트 등록 및 정보를 출력하자.</li>
  <li><strong>라이브러리로 확장하여 재사용가능한 컴포넌트를 개발하자.</strong></li>
  <li>좀더 advanced한 요소 몇개를 포함시켜</li>
</ul>

<h2 id="3-references">3. References</h2>
<ul>
  <li>먼저 참고했던 대표적 자료를 명시한다.</li>
  <li>http://blog.hkwon.me/draw-korean-map-chart-with-geojson/</li>
</ul>

<h2 id="4-geojson-생성">4. GeoJSON 생성</h2>
<ul>
  <li>GeoJSON을 생성하기 위해 여러가지 변환작업이 필요하다.</li>
</ul>

<h3 id="41-shp다운로드">4.1 SHP다운로드</h3>
<ul>
  <li>GeoJSON파일을 생성하기 위해서 한국의 구역정보와 좌표정보가 포함된 SHP파일이 필요하다(SHP파일의 정확한 정의 및 포맷을 알고싶으면 구글링을 하자).</li>
  <li>해당 SHP파일은 공간정보시스템 기반 기술 연구소[http://www.gisdeveloper.co.kr/?p=2332] 에서 다운받자.</li>
  <li>시도/시군구/읍면동/리 단위로 제공되는 파일중 필요한것을 다운받자. 여기서는 읍면동을 선택하였다.</li>
  <li>참고로 해당 데이터는 법정동 코드르를 기준으로 데이터가 구성되어 있다.</li>
</ul>

<h3 id="42-좌표변환">4.2 좌표변환</h3>
<ul>
  <li>다운 받은 SHP파일의 내용이 보이지는 않지만 포함된 좌표값이 구글맵에서 지원하는 위도경도기반이 아니다.</li>
  <li>여기서는 국가에서 제공하는 수치지도활용소프트웨어[http://www.nsdi.go.kr/index.html?menuno=2772&amp;cateIndex=712&amp;bbsno=233&amp;boardno=552&amp;ztag=rO0ABXQAMDxjYWxsIHR5cGU9ImJvYXJkIiBza2luPSJmcmVlIiBubz0iNTUyIiA%2BPC9jYWxsPg%3D%3D&amp;siteno=18&amp;act=view] 를 포함하여 좌표체게를 변환한다.</li>
  <li>먼저 해당 프로그램에서 다운받은 shp파일(공간정보시스템 연구소에서 제공하는 파일을 다운받고 압축을 풀면 dbs와 shx파일이 포함되어있지만 shp만 사용한다)을 불러온다.</li>
  <li>메뉴중 좌표변환메뉴를 선택한다.</li>
  <li>입력사항은 UTM-K이고 출력사항은 경위도로 선택한다(그냥 처음 선택하면 다 설정이 되어있다).</li>
  <li>편환하여 저장하면 새로운 shp파일이 생성된다.</li>
</ul>

<h3 id="43-geojson변환">4.3 GeoJSON변환</h3>
<ul>
  <li>여기서는 GeoJSON파일로 변환하기 위해 <strong>ogr2ogr(GDAL)</strong>을 사용한다.</li>
  <li>구글링을 통해 사용하는 플랫폼에 해당하는 버전을 다운받고 설치 후, 패스를 설정한다.</li>
  <li>윈도우에서는 다움과 같은 명령어를 cmd에서 입력했다(dong.json은 출력파일이름이고 TL_SCCO_EMD_CONV.shp는 입력파일이름이다).
    <blockquote>
      <p>ogr2ogr -f GeoJSON dong.json TL_SCCO_EMD_CONV.shp</p>
    </blockquote>
  </li>
</ul>

<h3 id="44-경량화">4.4 경량화</h3>
<ul>
  <li>현재까지의 작업내용을 통해서도 구글에 레이어를 출력할 수 있다.</li>
  <li>하지만 웹 환경에서는 반응속도가 중요하기 때문에 레이어를 경량화하여 용량을 줄여 사용한다.</li>
  <li>구글맵에 올릴것이기 때문에 레이어가 보간되어도 사용자 입장에서 큰 차이점을 못느끼고 사용한다.</li>
  <li>해당작업을 위해 mapshaper[http://mapshaper.org] 에 GeoJSON파일을 입력하고 Simplify를 진행한다.</li>
  <li>여기서는 10%까지 simplify한 결과 대략 70MB에서 4MB까지 줄였다.</li>
</ul>

<h2 id="5-구글지도">5. 구글지도</h2>
<ul>
  <li>지도는 설명대신 코드를 첨부한다.</li>
  <li>npm install후 node app.js을 통해 확인 할 수 있다.</li>
  <li>index.html에 [SERVICE_KEY]부분에 구글 키를 입력한다.</li>
</ul>

<p><img src="/public/google-map-layer.png" alt="./1차결과.PNG" /></p>

<h2 id="references">References</h2>
<ul>
  <li><a href="github.com/youngwonseo/NCI">github.com/yongwonseo/NCI</a></li>
</ul>


  
  <div class="post-disqus">
      <section id="disqus_thread"></section>
      <div id="disqus_thread"></div>
<script>

/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
/*
var disqus_config = function () {
this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
*/
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = 'https://youngwonseo.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
                            
  </div>
  
</div>

<div class="pagination">
  
    <a href="/2019/02/17/redis-quick-start/" class="left arrow">&#8592;</a>
  
  
    <a href="/2019/01/21/java-unicode-to-korean/" class="right arrow">&#8594;</a>
  

  <a href="#" class="top">Top</a>
</div>

    </main>

    <footer>
      <span>
        &copy; <time datetime="2019-05-02 19:13:12 +0900">2019</time> Youngwon Seo. Made with Jekyll using the <a href="https://github.com/chesterhow/tale/">Tale</a> theme.
      </span>
    </footer>
  </body>
</html>
