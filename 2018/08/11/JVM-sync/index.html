<!DOCTYPE html>
<html>

  <head>
	<!-- Meta -->
	<meta charset="UTF-8"/>
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
	<meta name="generator" content="Jekyll">

	<title>JVM Thread와 동기화</title>
  <meta name="description" content="">

	<!-- CSS & fonts -->
  <link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,500" rel="stylesheet">
  <link rel="stylesheet" href="/css/main.css">

  <!-- Open Graph -->
  <meta property="og:title" content="JVM Thread와 동기화">
  <meta property="og:type" content: "website">
  <meta property="og:url" content= "https://thereviewindex.com/blog/2018/08/11/JVM-sync/">
  <meta property="og:description" content="">
  <meta property="og:locale" content= "en_US">
  <meta property="og:site_name" content="The Review Index">
  <meta property="og:image" content="https://thereviewindex.com/blog/">
  <meta property="og:image:url" content="https://thereviewindex.com/blog/">
  <meta property="og:image:secure_url" content="https://thereviewindex.com/blog/">
  <meta property="og:image:type" content="image/png">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="1200">
  
  <!-- twitter card -->
  <meta property="twitter:card" content="summary">
  <meta property="twitter:title" content="JVM Thread와 동기화">
  <meta property="twitter:description" content="">
  <meta property="twitter:url" content= "https://thereviewindex.com/blog/2018/08/11/JVM-sync/">
  <meta property="twitter:image" content="https://thereviewindex.com/blog/">


	<!-- RSS -->
	<link href="/atom.xml" type="application/atom+xml" rel="alternate" title="ATOM Feed" />

  <!-- Favicon -->
  <link rel="shortcut icon" type="image/png" href="img/favicon.png">


  <!-- Google Analytics -->
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  
  ga('create', 'UA-78263144-1', 'auto');
  ga('send', 'pageview');
  </script>
  <!-- End Google Analytics -->

</head>

  <body>
    
    <!-- Facebook Comments Script -->
    <div id="fb-root"></div>
      <script>(function(d, s, id) {
        var js, fjs = d.getElementsByTagName(s)[0];
        if (d.getElementById(id)) return;
        js = d.createElement(s); js.id = id;
        js.src = 'https://connect.facebook.net/en_GB/sdk.js#xfbml=1&version=v2.11&appId=288262758360783';
        fjs.parentNode.insertBefore(js, fjs);
      }(document, 'script', 'facebook-jssdk'));</script>
  
    <div id="wrap">
  	  	
  	  	<!-- Navigation -->
  	  	<nav id="nav">
	<div id="nav-list">
		<a href="/">Home</a>

		<!-- Nav pages -->
	  
	    
	  
	    
	  
	    
	      <a href="/about/" title="About">About</a>
	    
	  
	    
	      <a href="/archive/" title="Archive">Archive</a>
	    
	  
	    
	  
	    
	  
	    
	  
	    
	      <a href="/ml/" title="Machine Learning">Machine Learning</a>
	    
	  
	    
	      <a href="/ml_medicine/" title="ML for Medicine">ML for Medicine</a>
	    
	  
	    
	      <a href="/paper_review/" title="Paper Review">Paper Review</a>
	    
	  
	    
	      <a href="/projects/" title="Projects">Projects</a>
	    
	  
	    
	  
	    
	      <a href="/study/" title="Study">Study</a>
	    
	  
	    
	  
	    
	  
	    
	  
	    
	  
	    
	  
	    
	  
	    
	  
	    
	  
	    
	  
	    
	  
    
    <!-- Nav links -->
	  <!-- <a href="/">Blog</a> -->


	</div>
  
  <!-- Nav footer -->
	
	  <footer>
	
	<!-- Your custom nav footer here -->
	
</footer>
	

</nav>

      
      <!-- Icon menu -->
  	  <a id="nav-menu">
  	  	<div id="menu"></div>
  	  </a>
  
        <!-- Header -->
        
          <header id="header">

	<!-- Your custom header here -->
	<span class="f-left">  
		<a href="/">
			<h1>
				<span>Youngwon Seo</span>
			</h1>
		</a>
	</span>

	<span id="nav-links" class="absolute right bottom">
		<!-- Nav pages -->
		
			
		
			
		
			
				<a href="/about/" title="About">About</a>
			
		
			
				<a href="/archive/" title="Archive">Archive</a>
			
		
			
		
			
		
			
		
			
				<a href="/ml/" title="Machine Learning">Machine Learning</a>
			
		
			
				<a href="/ml_medicine/" title="ML for Medicine">ML for Medicine</a>
			
		
			
				<a href="/paper_review/" title="Paper Review">Paper Review</a>
			
		
			
				<a href="/projects/" title="Projects">Projects</a>
			
		
			
		
			
				<a href="/study/" title="Study">Study</a>
			
		
			
		
			
		
			
		
			
		
			
		
			
		
			
		
			
		
			
		
			
		
		
		<!-- Nav links -->
		<!-- <a href="/">Blog</a> -->

	</span>
	
	<!-- Google Analytics -->
  <script>
		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
		
		ga('create', 'UA-78263144-1', 'auto');
		ga('send', 'pageview');
		</script>
		<!-- End Google Analytics -->
</header>


        
  
      <!-- Main content -->
  	  <div id="container">
  		  
  		<main>
  
  			<article id="post-page">
  <div class="parent f-right">
    <!-- Twitter -->
    <a href="https://twitter.com/share?url=https://thereviewindex.com/blog/2018/08/11/JVM-sync/&amp;text=JVM Thread와 동기화&amp;hashtags=thereviewindex" target="_blank">
      <span class="social-icon">  
        <svg class="svgIcon-use" width="29" height="29" viewBox="0 0 29 29"><path d="M21.967 11.8c.018 5.93-4.607 11.18-11.177 11.18-2.172 0-4.25-.62-6.047-1.76l-.268.422-.038.5.186.013.168.012c.3.02.44.032.6.046 2.06-.026 3.95-.686 5.49-1.86l1.12-.85-1.4-.048c-1.57-.055-2.92-1.08-3.36-2.51l-.48.146-.05.5c.22.03.48.05.75.08.48-.02.87-.07 1.25-.15l2.33-.49-2.32-.49c-1.68-.35-2.91-1.83-2.91-3.55 0-.05 0-.01-.01.03l-.49-.1-.25.44c.63.36 1.35.57 2.07.58l1.7.04L7.4 13c-.978-.662-1.59-1.79-1.618-3.047a4.08 4.08 0 0 1 .524-1.8l-.825.07a12.188 12.188 0 0 0 8.81 4.515l.59.033-.06-.59v-.02c-.05-.43-.06-.63-.06-.87a3.617 3.617 0 0 1 6.27-2.45l.2.21.28-.06c1.01-.22 1.94-.59 2.73-1.09l-.75-.56c-.1.36-.04.89.12 1.36.23.68.58 1.13 1.17.85l-.21-.45-.42-.27c-.52.8-1.17 1.48-1.92 2L22 11l.016.28c.013.2.014.35 0 .52v.04zm.998.038c.018-.22.017-.417 0-.66l-.498.034.284.41a8.183 8.183 0 0 0 2.2-2.267l.97-1.48-1.6.755c.17-.08.3-.02.34.03a.914.914 0 0 1-.13-.292c-.1-.297-.13-.64-.1-.766l.36-1.254-1.1.695c-.69.438-1.51.764-2.41.963l.48.15a4.574 4.574 0 0 0-3.38-1.484 4.616 4.616 0 0 0-4.61 4.613c0 .29.02.51.08.984l.01.02.5-.06.03-.5c-3.17-.18-6.1-1.7-8.08-4.15l-.48-.56-.36.64c-.39.69-.62 1.48-.65 2.28.04 1.61.81 3.04 2.06 3.88l.3-.92c-.55-.02-1.11-.17-1.6-.45l-.59-.34-.14.67c-.02.08-.02.16 0 .24-.01 2.12 1.55 4.01 3.69 4.46l.1-.49-.1-.49c-.33.07-.67.12-1.03.14-.18-.02-.43-.05-.64-.07l-.76-.09.23.73c.57 1.84 2.29 3.14 4.28 3.21l-.28-.89a8.252 8.252 0 0 1-4.85 1.66c-.12-.01-.26-.02-.56-.05l-.17-.01-.18-.01L2.53 21l1.694 1.07a12.233 12.233 0 0 0 6.58 1.917c7.156 0 12.2-5.73 12.18-12.18l-.002.04z"></path></svg>
      </span>
    </a>

    &nbsp;&nbsp;&nbsp;
    <!-- Facebook -->
    <a href="http://www.facebook.com/sharer.php?u=https://thereviewindex.com/blog/2018/08/11/JVM-sync/" target="_blank">
      <span class="social-icon">
        <svg class="svgIcon-use" width="29" height="29" viewBox="0 0 29 29"><path d="M16.39 23.61v-5.808h1.846a.55.55 0 0 0 .546-.48l.36-2.797a.551.551 0 0 0-.547-.62H16.39V12.67c0-.67.12-.813.828-.813h1.474a.55.55 0 0 0 .55-.55V8.803a.55.55 0 0 0-.477-.545c-.436-.06-1.36-.116-2.22-.116-2.5 0-4.13 1.62-4.13 4.248v1.513H10.56a.551.551 0 0 0-.55.55v2.797c0 .304.248.55.55.55h1.855v5.76c-4.172-.96-7.215-4.7-7.215-9.1 0-5.17 4.17-9.36 9.31-9.36 5.14 0 9.31 4.19 9.31 9.36 0 4.48-3.155 8.27-7.43 9.15M14.51 4C8.76 4 4.1 8.684 4.1 14.46c0 5.162 3.75 9.523 8.778 10.32a.55.55 0 0 0 .637-.543v-6.985a.551.551 0 0 0-.55-.55H11.11v-1.697h1.855a.55.55 0 0 0 .55-.55v-2.063c0-2.02 1.136-3.148 3.03-3.148.567 0 1.156.027 1.597.06v1.453h-.924c-1.363 0-1.93.675-1.93 1.912v1.78c0 .3.247.55.55.55h2.132l-.218 1.69H15.84c-.305 0-.55.24-.55.55v7.02c0 .33.293.59.623.54 5.135-.7 9.007-5.11 9.007-10.36C24.92 8.68 20.26 4 14.51 4"></path></svg>
      </span> 
    </a>
  </div>
  
  <h2>JVM Thread와 동기화</h2>		
	<div class="by-line parent">
    <time datetime="2018-08-11T00:00:00+09:00"> <i>11 Aug 2018</i> </time>
    &nbsp;&nbsp; &middot; &nbsp;&nbsp;
    <span><i></i> </span>
  </div>
	<div class="content">

		<h2 id="1-자바에서의-동기화">1. 자바에서의 동기화</h2>
<p>자바는 멀티쓰레딩을 지원합니다(정확하게 JVM이). 그리고 각 쓰레드를 동기화 하기 위해 Monitor를 사용합니다. 여기거 동기화란 여러 쓰레드가 동시에 한 메모리영역에 접근시 데이터의 무결정을 위해 락을 걸어 동시에 한 쓰레드만 접근가능하게 하는 것입니다. 자바는 동기화를 위해 문법적으로 synchronized를 이용하며 실제로는 Monitor의 메커니즘을 사용합니다. 정확하게 설명하면 Critical Section(여러쓰레드가 동시에 접근할려고 하는 구간)에 특정 쓰레드가 접근할 시 Lock 에대한 Object Monitor를 1증가시켜 해당 구간을 실행하고 빠져나오면 다시 1증가 시켰던 Monitor를 -1하여 다른 쓰레드가 접근가능하도록 만듭니다. 이를 위해 자바는 문법적으로 synchronized를 실행하는 것이죠. (멀티쓰레딩과 동기화 부분의 이론적 내용을 자세히 알고싶으신 분은 운영체제를 공부하시는 것을 추천합니다)
이렇게 쓰레드에 대한 동기화를 위해 각 쓰레드는 상태를  변경하며 프로그램이 실행되는데 이는 두 번째 절인 Thread의 상태 및 종류에서 살펴봅니다.</p>

<h2 id="2-thread-상태-및-종류">2. Thread 상태 및 종류</h2>
<h3 id="21-thread-상태">2.1 Thread 상태</h3>
<p>다음은 JVM에서의 Thread들 가지는 상태들이다. 여러가지 예외 발생(성능저하 또는 메모리관련, 데드락 등) 시 Thread Dump 분석을 통해서 해결해야 하는데 이때 다음과 같은 Thread 상태들을 정확히 이해하고 있어야 한다.</p>
<ul>
  <li>NEW - Thread가 생성되어있지만 아직 실행되지 않은 상태</li>
  <li>RUNNABLE - 현재 CPU를 점유하고 작업을 수행중인 상태, 운영체제의 자원 분배로 인해 WAITING상태가 될 수 있다.</li>
  <li>BLOCKED - Monitor를 획득하기 위해 다른 Thread가 Lock을 해제하기를 기다리는 상태</li>
  <li>WAITING - wait(), join(),park() 등의 메서드를 이용해 대기하고 있는 상태</li>
  <li>TIMED_WAITING - sleep(), wait(), join(), park() 등의 메서드를 이용해 대기하고 있는 상태, WAITING 상태와의 차이점은 메서드의 인수로 최대 대기 시간을 명시할 수 있어 외부 변화뿐만 아니라 시간에 의해 WAITING 상태가 해제될 수 있다.</li>
</ul>

<p><img src="https://qph.ec.quoracdn.net/main-qimg-bb9b26ebdf42c3f502f1a6318664e04e" alt="" /></p>
<h3 id="22-thread-종류">2.2 Thread 종류</h3>
<p>JVM Thread는 데몬(Daemon) 또는 비 데몬(Non-daemon) Thread로 나뉜다. 데몬 Thread 는 비 데몬 Thread가 존재하지 않으면 자동으로  은 JVM에 의해, 비 데몬은 사용자에 의해 생선되는 Thread이다. 예로 들면 GC는 데몬,</p>
<ul>
  <li>VM-Background Thread - compile, optimization, GC 등 JVM 내부의 일을 수행하는  Background Thread등</li>
  <li>Main Thread Thread - main메서드를 실행하는 Thread, 사용자가 명시적으로 실행하지 않더라도 JVM이 실행</li>
  <li>User Thread Thread - 사용자에 의해 명시적으로 생성된 Thread들,  Thread 클래스 상속, Runnable 인터페이스 구현 등으로 생성</li>
</ul>

<h2 id="3-thread-dump">3. Thread Dump</h2>
<p>Thread Dump를 통해 Java에서 발생하는 여러가지 문제를 분석할 수 있습니다. Thread Dump를 가져오기 위해서는 플렛폼별 지원하는 커멘드를 사용하여 가져올 수 있지만 여기서는 여러 플렛폼에서 공통으로 사용가능한 Jstack을 사용하여 dump를 간단히 살펴보겠습니다. 상세정보는 References에 명시된 책이나 웹사이트를 방문해서 살펴봐주세요.
다음은 책에서 Case1으로 소개된 synchroinized에 의한 동기화의 소스코드입니다.</p>

<p>DumpText.java</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">DumpTest</span> <span class="o">{</span>
	<span class="kd">static</span> <span class="nc">Object</span> <span class="nc">Lock</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Object</span><span class="o">();</span>	
	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">new</span> <span class="nf">Thread2</span><span class="o">().</span><span class="na">start</span><span class="o">();</span>
		<span class="k">try</span> <span class="o">{</span>
			<span class="nc">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">10</span><span class="o">);</span>
		<span class="o">}</span><span class="k">catch</span><span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>			
		<span class="o">}</span>
		<span class="k">new</span> <span class="nf">Thread1</span><span class="o">().</span><span class="na">start</span><span class="o">();</span>
		<span class="k">new</span> <span class="nf">Thread1</span><span class="o">().</span><span class="na">start</span><span class="o">();</span>
		<span class="k">new</span> <span class="nf">Thread1</span><span class="o">().</span><span class="na">start</span><span class="o">();</span>
	<span class="o">}</span>	
<span class="o">}</span>	
</code></pre></div></div>

<p>Thread1.java</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Thread1</span> <span class="kd">extends</span> <span class="nc">Thread</span> <span class="o">{</span>	
	<span class="kt">int</span> <span class="n">idx</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>	
	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">while</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
			<span class="kd">synchronized</span><span class="o">(</span><span class="nc">DumpTest</span><span class="o">.</span><span class="na">Lock</span><span class="o">)</span> <span class="o">{</span>
				<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">idx</span><span class="o">++</span> <span class="o">+</span> <span class="s">" looping"</span><span class="o">);</span>
			<span class="o">}</span>
		<span class="o">}</span>
	<span class="o">}</span>	
<span class="o">}</span>
</code></pre></div></div>

<p>Thread2.java</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Thread2</span> <span class="kd">extends</span> <span class="nc">Thread</span><span class="o">{</span>	
	<span class="kt">int</span> <span class="n">idx</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>	
	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">while</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
			<span class="kd">synchronized</span><span class="o">(</span><span class="nc">DumpTest</span><span class="o">.</span><span class="na">Lock</span><span class="o">)</span> <span class="o">{</span>
				<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">idx</span><span class="o">++</span> <span class="o">+</span> <span class="s">" looping"</span><span class="o">);</span>
			<span class="o">}</span>
		<span class="o">}</span>
	<span class="o">}</span>	
<span class="o">}</span>
</code></pre></div></div>
<p>Thread1과 Thread2는 같은 코드입니다.  여기서 각 Thread에 대한 run에서 synchronized를 통해 동기화를 하는데 DumpTest 클레스에 속한 Lock오브젝트를 monitor를 사용합니다.</p>

<p>저는 윈도우즈 환경에서 Jstack을 통해  dump를 얻었고 내용은 다음과 같습니다(jstack 사용법 - $ jstack [PID]).</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Full thread dump Java HotSpot(TM) 64-Bit Server VM (25.144-b01 mixed mode):

"DestroyJavaVM" #14 prio=5 os_prio=0 tid=0x0000000002dce800 nid=0x3ec0 waiting on condition [0x0000000000000000]
   java.lang.Thread.State: RUNNABLE

"Thread-3" #13 prio=5 os_prio=0 tid=0x0000000026f82000 nid=0x2bb8 runnable [0x0000000027d1e000]
   java.lang.Thread.State: RUNNABLE
        at java.io.FileOutputStream.writeBytes(Native Method)
        at java.io.FileOutputStream.write(Unknown Source)
        at java.io.BufferedOutputStream.flushBuffer(Unknown Source)
        at java.io.BufferedOutputStream.flush(Unknown Source)
        - locked &lt;0x00000005c1412e58&gt; (a java.io.BufferedOutputStream)
        at java.io.PrintStream.write(Unknown Source)
        - locked &lt;0x00000005c1404728&gt; (a java.io.PrintStream)
        at sun.nio.cs.StreamEncoder.writeBytes(Unknown Source)
        at sun.nio.cs.StreamEncoder.implFlushBuffer(Unknown Source)
        at sun.nio.cs.StreamEncoder.flushBuffer(Unknown Source)
        - locked &lt;0x00000005c1412f80&gt; (a java.io.OutputStreamWriter)
        at java.io.OutputStreamWriter.flushBuffer(Unknown Source)
        at java.io.PrintStream.write(Unknown Source)
        - eliminated &lt;0x00000005c1404728&gt; (a java.io.PrintStream)
        at java.io.PrintStream.print(Unknown Source)
        at java.io.PrintStream.println(Unknown Source)
        - locked &lt;0x00000005c1404728&gt; (a java.io.PrintStream)
        at Thread1.run(Thread1.java:10)
        - locked &lt;0x00000005c1406378&gt; (a java.lang.Object)

"Thread-2" #12 prio=5 os_prio=0 tid=0x0000000026f81800 nid=0xa48 waiting for monitor entry [0x0000000027c1f000]
   java.lang.Thread.State: BLOCKED (on object monitor)
        at Thread1.run(Thread1.java:9)
        - waiting to lock &lt;0x00000005c1406378&gt; (a java.lang.Object)

"Thread-1" #11 prio=5 os_prio=0 tid=0x0000000026f7f800 nid=0x3ff4 waiting for monitor entry [0x0000000027b1e000]
   java.lang.Thread.State: BLOCKED (on object monitor)
        at Thread1.run(Thread1.java:9)
        - waiting to lock &lt;0x00000005c1406378&gt; (a java.lang.Object)

"Thread-0" #10 prio=5 os_prio=0 tid=0x0000000026f1e000 nid=0x3414 waiting for monitor entry [0x0000000027a1f000]
   java.lang.Thread.State: BLOCKED (on object monitor)
        at Thread2.run(Thread2.java:9)
        - waiting to lock &lt;0x00000005c1406378&gt; (a java.lang.Object)

"Service Thread" #9 daemon prio=9 os_prio=0 tid=0x0000000025a9d000 nid=0x389c runnable [0x0000000000000000]
   java.lang.Thread.State: RUNNABLE

"C1 CompilerThread2" #8 daemon prio=9 os_prio=2 tid=0x0000000025a62000 nid=0x2a2c waiting on condition [0x0000000000000000]
   java.lang.Thread.State: RUNNABLE

"C2 CompilerThread1" #7 daemon prio=9 os_prio=2 tid=0x0000000025a5f000 nid=0x348c waiting on condition [0x0000000000000000]
   java.lang.Thread.State: RUNNABLE

"C2 CompilerThread0" #6 daemon prio=9 os_prio=2 tid=0x0000000025a50000 nid=0x248 waiting on condition [0x0000000000000000]
   java.lang.Thread.State: RUNNABLE

"Attach Listener" #5 daemon prio=5 os_prio=2 tid=0x0000000025a4e000 nid=0x24e4 waiting on condition [0x0000000000000000]
   java.lang.Thread.State: RUNNABLE

"Signal Dispatcher" #4 daemon prio=9 os_prio=2 tid=0x0000000026e62800 nid=0x37b8 runnable [0x0000000000000000]
   java.lang.Thread.State: RUNNABLE

"Finalizer" #3 daemon prio=8 os_prio=1 tid=0x0000000025a2a800 nid=0x3c70 in Object.wait() [0x0000000026d9f000]
   java.lang.Thread.State: WAITING (on object monitor)
        at java.lang.Object.wait(Native Method)
        - waiting on &lt;0x00000005c1406ae8&gt; (a java.lang.ref.ReferenceQueue$Lock)
        at java.lang.ref.ReferenceQueue.remove(Unknown Source)
        - locked &lt;0x00000005c1406ae8&gt; (a java.lang.ref.ReferenceQueue$Lock)
        at java.lang.ref.ReferenceQueue.remove(Unknown Source)
        at java.lang.ref.Finalizer$FinalizerThread.run(Unknown Source)

"Reference Handler" #2 daemon prio=10 os_prio=2 tid=0x0000000002ec1800 nid=0x3d54 in Object.wait() [0x0000000026c9f000]
   java.lang.Thread.State: WAITING (on object monitor)
        at java.lang.Object.wait(Native Method)
        - waiting on &lt;0x00000005c1408b40&gt; (a java.lang.ref.Reference$Lock)
        at java.lang.Object.wait(Unknown Source)
        at java.lang.ref.Reference.tryHandlePending(Unknown Source)
        - locked &lt;0x00000005c1408b40&gt; (a java.lang.ref.Reference$Lock)
        at java.lang.ref.Reference$ReferenceHandler.run(Unknown Source)

"VM Thread" os_prio=2 tid=0x0000000025a07800 nid=0x3144 runnable

"GC task thread#0 (ParallelGC)" os_prio=0 tid=0x0000000002de7800 nid=0x2290 runnable

"GC task thread#1 (ParallelGC)" os_prio=0 tid=0x0000000002de9000 nid=0x27d4 runnable

"GC task thread#2 (ParallelGC)" os_prio=0 tid=0x0000000002dea800 nid=0x1cd0 runnable

"GC task thread#3 (ParallelGC)" os_prio=0 tid=0x0000000002ded000 nid=0x548 runnable

"VM Periodic Task Thread" os_prio=2 tid=0x0000000026f09800 nid=0x2db0 waiting on condition

JNI global references: 14
</code></pre></div></div>
<p>먼저 Thread-0, Thread-1, Thread-2, Thread-3 나타난 것을 볼 수 있다. 4개의 Thread를 생성하였기 때문이다. 각 Thread는 tid라는 고유 아이디를 가지고 있고 상태(RUNNABLE, BLOCKED, WAITING)를 가지고 있다. 위 코드에서 살펴본것과 같이 동기화를 위해 DumpTest.Lock 오브젝트의 모니터를 사용하고 있는데 waiting for monitor entry이라는 문구가 특정 모니터 점유를 대기하고 있다는 의미이고 BLOCKED 상태의 dump를 살펴보면 Lock(해시값 : 0x00000005c1406378)의 점유를 위해 대기하고 있는 것을 알수있다.</p>

<h2 id="references">References</h2>
<ul>
  <li>JVM Performance Optimizing 및 성능분석 사례</li>
  <li>https://www.quora.com/What-is-a-thread-state</li>
</ul>

		
  </div>

  <div class="parent f-right">
    <!-- Twitter -->
    <a href="https://twitter.com/share?url=https://thereviewindex.com/blog/2018/08/11/JVM-sync/&amp;text=JVM Thread와 동기화&amp;hashtags=thereviewindex" target="_blank">
      <span class="social-icon">  
        <svg class="svgIcon-use" width="29" height="29" viewBox="0 0 29 29"><path d="M21.967 11.8c.018 5.93-4.607 11.18-11.177 11.18-2.172 0-4.25-.62-6.047-1.76l-.268.422-.038.5.186.013.168.012c.3.02.44.032.6.046 2.06-.026 3.95-.686 5.49-1.86l1.12-.85-1.4-.048c-1.57-.055-2.92-1.08-3.36-2.51l-.48.146-.05.5c.22.03.48.05.75.08.48-.02.87-.07 1.25-.15l2.33-.49-2.32-.49c-1.68-.35-2.91-1.83-2.91-3.55 0-.05 0-.01-.01.03l-.49-.1-.25.44c.63.36 1.35.57 2.07.58l1.7.04L7.4 13c-.978-.662-1.59-1.79-1.618-3.047a4.08 4.08 0 0 1 .524-1.8l-.825.07a12.188 12.188 0 0 0 8.81 4.515l.59.033-.06-.59v-.02c-.05-.43-.06-.63-.06-.87a3.617 3.617 0 0 1 6.27-2.45l.2.21.28-.06c1.01-.22 1.94-.59 2.73-1.09l-.75-.56c-.1.36-.04.89.12 1.36.23.68.58 1.13 1.17.85l-.21-.45-.42-.27c-.52.8-1.17 1.48-1.92 2L22 11l.016.28c.013.2.014.35 0 .52v.04zm.998.038c.018-.22.017-.417 0-.66l-.498.034.284.41a8.183 8.183 0 0 0 2.2-2.267l.97-1.48-1.6.755c.17-.08.3-.02.34.03a.914.914 0 0 1-.13-.292c-.1-.297-.13-.64-.1-.766l.36-1.254-1.1.695c-.69.438-1.51.764-2.41.963l.48.15a4.574 4.574 0 0 0-3.38-1.484 4.616 4.616 0 0 0-4.61 4.613c0 .29.02.51.08.984l.01.02.5-.06.03-.5c-3.17-.18-6.1-1.7-8.08-4.15l-.48-.56-.36.64c-.39.69-.62 1.48-.65 2.28.04 1.61.81 3.04 2.06 3.88l.3-.92c-.55-.02-1.11-.17-1.6-.45l-.59-.34-.14.67c-.02.08-.02.16 0 .24-.01 2.12 1.55 4.01 3.69 4.46l.1-.49-.1-.49c-.33.07-.67.12-1.03.14-.18-.02-.43-.05-.64-.07l-.76-.09.23.73c.57 1.84 2.29 3.14 4.28 3.21l-.28-.89a8.252 8.252 0 0 1-4.85 1.66c-.12-.01-.26-.02-.56-.05l-.17-.01-.18-.01L2.53 21l1.694 1.07a12.233 12.233 0 0 0 6.58 1.917c7.156 0 12.2-5.73 12.18-12.18l-.002.04z"></path></svg>
      </span>
    </a>

    &nbsp;&nbsp;&nbsp;
    <!-- Facebook -->
    <a href="http://www.facebook.com/sharer.php?u=https://thereviewindex.com/blog/2018/08/11/JVM-sync/" target="_blank">
      <span class="social-icon">
        <svg class="svgIcon-use" width="29" height="29" viewBox="0 0 29 29"><path d="M16.39 23.61v-5.808h1.846a.55.55 0 0 0 .546-.48l.36-2.797a.551.551 0 0 0-.547-.62H16.39V12.67c0-.67.12-.813.828-.813h1.474a.55.55 0 0 0 .55-.55V8.803a.55.55 0 0 0-.477-.545c-.436-.06-1.36-.116-2.22-.116-2.5 0-4.13 1.62-4.13 4.248v1.513H10.56a.551.551 0 0 0-.55.55v2.797c0 .304.248.55.55.55h1.855v5.76c-4.172-.96-7.215-4.7-7.215-9.1 0-5.17 4.17-9.36 9.31-9.36 5.14 0 9.31 4.19 9.31 9.36 0 4.48-3.155 8.27-7.43 9.15M14.51 4C8.76 4 4.1 8.684 4.1 14.46c0 5.162 3.75 9.523 8.778 10.32a.55.55 0 0 0 .637-.543v-6.985a.551.551 0 0 0-.55-.55H11.11v-1.697h1.855a.55.55 0 0 0 .55-.55v-2.063c0-2.02 1.136-3.148 3.03-3.148.567 0 1.156.027 1.597.06v1.453h-.924c-1.363 0-1.93.675-1.93 1.912v1.78c0 .3.247.55.55.55h2.132l-.218 1.69H15.84c-.305 0-.55.24-.55.55v7.02c0 .33.293.59.623.54 5.135-.7 9.007-5.11 9.007-10.36C24.92 8.68 20.26 4 14.51 4"></path></svg>
      </span> 
    </a>
  </div>

  <!-- Facebook Comments HTML -->
  <div class="m-t-6e">
    <div class="fb-comments" data-href="http://localhost:4000/2018/08/11/JVM-sync/" data-width="800" data-numposts="5"></div>
  </div>

</article>


  
  	  </main>
  		
  		  <!-- Pagination links -->
        
  
  	  </div>
  	    
  	    <!-- Footer -->
        <div class="m-t-6e">
          <footer><span>&#169;2017 - TheReviewIndex</span></footer>

        </div>
  
  	    <!-- Script -->
        <script src="/js/main.js"></script>	

  
    </div>
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-118401942-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-118401942-1');
</script>
  </body>
</html>
