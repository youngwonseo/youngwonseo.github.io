<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>
    
      톰캣 Hot Swap적용하기(무료버전) &middot; Youngwon Seo
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/assets/main.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Libre+Baskerville:400,400i,700">

  <!-- Favicon -->
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon-16x16.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png">
</head>

  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-118401942-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-118401942-1');
</script>

  <body>
    <nav class="nav">
      <div class="nav-container">
        <a href="/">
          <h2 class="nav-title">Youngwon Seo</h2>
        </a>
        <ul>
          <li><a href="/about">About</a></li>
          <li><a href="/">Posts</a></li>
          <li><a href="/study"/>Study</a></li>
          <li><a href="/ml"/>Machine Learning</a></li>
          <li><a href="/people"/>People</a></li>
          <!-- <li><a href="/spring"/>Spring</a></li>
          <li><a href="/deeplearning"/>Deeplearning</a></li> -->
        </ul>
    </div>
  </nav>

    <main>
      <div class="post">
  <div class="post-info">
    <span>Written by</span>
    
        Youngwon Seo
    

    
      <br>
      <span>on&nbsp;</span><time datetime="2018-08-09 00:00:00 +0900">August 09, 2018</time>
    
  </div>

  <h1 class="post-title">톰캣 Hot Swap적용하기(무료버전)</h1>
  <div class="post-line"></div>

  <h2 id="hot-swap">Hot swap?</h2>
<p>보통의 경우 톰캣이 실행중일때 자바코드를 수정하게되면 이클립스 또는 톰캣의 auto reloading등의 기능을 활성화해놔도 톰캣을 재실행 해야 현재run time환경에 적용됩니다. 즉, 자바의 텍스트가 하나 변경되도 톰캣을 재실행해야 되는데, 이는 개발 생산성을 감소시키는 요소중 한 가지 입니다(그리고 이는 충분히 큰 문제입니다).
이러한 재시작에 대한 문제점을 해결하는 여러가지 도구들이 존재하는데, 회사에 재직중이라면 상용제품을 사용하는 것이 제일 좋은 방법입니다. 저는 Jrebel을 사용하고 있었는데 라이센스가 끝나(jrebel정책변경으로인해) 무료 Hot swap도구를 찾던 중 아래과 같은 HotSwapAgent를 발견하였습니다.</p>

<h2 id="설치방법">설치방법</h2>
<p>아래는 윈도우즈 환경에서의 설치 방법입니다.</p>
<h3 id="1-dcevm-설치">1. dcevm 설치</h3>
<ol>
  <li>Dynamic Code Evolution VM을 설치합니다. 현재 사용중인 자바 버전에 해당하는 *-instarller.jar파일을 다운로드합니다. (https://github.com/dcevm/dcevm/releases)</li>
  <li>cmd를 실행하여 다운받은 installer.jar파일을 실행합니다. <strong>주의하실 점은 cmd창 실행 시 관리자 권한으로 실행해야 합니다.</strong> installer.jar파일이 존재하는 디렉토리로 이동후 <strong>java -jar DCEVM-8u181-installer.jar</strong> 를 입력하고 실행하시면 jar파일이 실행됩니다. 물론 java -jar 뒤에는 다운받은 파일의 이름입니다.</li>
  <li>실행창 우측의 [Installed altjvm?] 이 Yes일 경우 설치가 완료된 것을 의미합니다. 설치가 되어있지 않다면 원하는 jdk를 선택 후 [Install DCEVM as altjvm]을 선택하여 설치를 합니다.</li>
</ol>

<h3 id="2-hotswapagent-다운로드">2. HotswapAgent 다운로드</h3>
<ol>
  <li>HotswapAgent를 다운받습니다. (https://github.com/HotswapProjects/HotswapAgent/releases)</li>
  <li>다운 받은 jar파일을 특정 디렉토리에 위치시킵니다. 아무위치나 상관없지만 추후 지워지거나 이동이 되면 안됩니다.</li>
</ol>

<h3 id="3-tomcat-설정-변경">3. Tomcat 설정 변경</h3>
<p>이클립스에서 톰캣을 더블클릭하면 설정화면을 볼 수 있습니다. 여기서 다음과 같이 설정합니다.</p>
<ol>
  <li>Overview
1.1 General Information -&gt; Open launch configuration -&gt; Arguments탭 -&gt; VM arguments의 내용뒤에 다음을 입력 “-XXaltjvm=dcevm -javaagent:C:\dev\java\hotswap-agent-1.3.0.jar” (<strong>-javaagent에 대한 경로는 2번에서 다운로드 받은 How Swap Agent의 경로, 쌍따움표는 입력안함</strong>)
1.2 Server Options -&gt; 전부 체크 해제(디폴트로 [Modules auto reload by default]가 체크되어 있는 경우가 있는데 체크를 해제합니다)
1.3 Publishing -&gt; [Automatically publish when resources change] 선택</li>
  <li>Modules
2.1 해당 프로젝트의 [Auto reloading enabled] 체크 해제</li>
</ol>

<h2 id="실행-및-후기">실행 및 후기</h2>
<p>톰캣을 디버깅 모드로 시작하면 아래와 같은 문구가 콘솔에 출력되며 실행이 됩니다.</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>HOTSWAP AGENT: 14:16:43.088 INFO (org.hotswap.agent.config.PluginRegistry) - Plugin 'org.hotswap.agent.plugin.tomcat.TomcatPlugin' initialized in ClassLoader 'WebappClassLoader
  context: 
  delegate: false
  repositories:
----------&gt; Parent Classloader:
</code></pre></div></div>
<p>특정 자바코드를 변경 후 저장을 하면 콘솔에 HOWSWAP AGENT 로그가 출력되며 Hot Swapping이 일어납니다.</p>

<p>역시나 상용제품인 jrebel에 비하면 느린감이 있고 디버깅모드에서만 동작을 하는 단점이 존재하네요. 또한 저는 Mongo template를 스프링에서 사용하고 있는데 해당 template를 사용하는 부분에서는 수정에 대한 hotswap이 발생할 시 Mongo Server와 커넥션이 다시 이루어 지지 않는 오류를 발생시켰습니다. 저한테는 굉장히 크리티컬한 오류라 계속사용하기 망설여지네요.</p>

<p>추가적으로 jrebel이 active되어 있다면 종료후 톰캣을 실행시켜야 정상동작합니다. 그렇지 않을 경우 톰캣이  start할 때, timeout을 발생시킵니다.</p>

<h2 id="references">References</h2>
<ul>
  <li>https://github.com/HotswapProjects/HotswapAgent</li>
  <li>https://m.blog.naver.com/bestheroz/220221138829</li>
  <li>http://riberio.tistory.com/entry/%EC%9D%B4%ED%81%B4%EB%A6%BD%EC%8A%A4-Hotswap-%EC%84%A4%EC%A0%95-DCEVM-Dynamic-Code-Evolution-VM</li>
  <li>https://zeroturnaround.com/software/jrebel/myjrebel-discontinued/</li>
</ul>


  
  <div class="post-disqus">
      <section id="disqus_thread"></section>
      <div id="disqus_thread"></div>
<script>

/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
/*
var disqus_config = function () {
this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
*/
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = 'https://youngwonseo.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
                            
  </div>
  
</div>

<div class="pagination">
  
    <a href="/2018/08/11/JVM-sync/" class="left arrow">&#8592;</a>
  
  
    <a href="/2018/08/05/REST/" class="right arrow">&#8594;</a>
  

  <a href="#" class="top">Top</a>
</div>

    </main>

    <footer>
      <span>
        &copy; <time datetime="2019-05-27 10:55:04 +0900">2019</time> Youngwon Seo. Made with Jekyll using the <a href="https://github.com/chesterhow/tale/">Tale</a> theme.
      </span>
    </footer>
  </body>
</html>
