<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>
    
      자바스크립트 클로저 - 속깊은 자바스크립트 &middot; Youngwon Seo
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/assets/main.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Libre+Baskerville:400,400i,700">

  <!-- Favicon -->
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon-16x16.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png">
</head>

  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-118401942-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-118401942-1');
</script>

  <body>
    <nav class="nav">
      <div class="nav-container">
        <a href="/">
          <h2 class="nav-title">Youngwon Seo</h2>
        </a>
        <ul>
          <li><a href="/about">About</a></li>
          <li><a href="/">Posts</a></li>
          <li><a href="/study"/>Study</a></li>
          <li><a href="/ml"/>Machine Learning</a></li>
          <li><a href="/gcp"/>GCP</a></li>
          <!-- <li><a href="/spring"/>Spring</a></li>
          <li><a href="/deeplearning"/>Deeplearning</a></li> -->
        </ul>
    </div>
  </nav>

    <main>
      <div class="post">
  <div class="post-info">
    <span>Written by</span>
    
        Youngwon Seo
    

    
      <br>
      <span>on&nbsp;</span><time datetime="2018-11-28 00:00:00 +0900">November 28, 2018</time>
    
  </div>

  <h1 class="post-title">자바스크립트 클로저 - 속깊은 자바스크립트</h1>
  <div class="post-line"></div>

  <h1 id="자바스크립트-클로저">자바스크립트 클로저</h1>
<p>클로저는 자바스크립트에서 중요한 개념으로 꼭 이해하고 넘어가야할 요소입니다. 그럼 클로저에 대해 알아봅시다.</p>

<h2 id="클로저란">클로저란?</h2>
<p>클로저는 다음과 같이 정의할 수 있습니다.</p>

<blockquote>
  <p>특정 함수가 참조하는 변수들이 선언된 렉시컬 스코프(lexical scope)는 계속 유지되는데, 그 함수와 스코프를 묶어서 클러저라고 한다.</p>
</blockquote>

<p>즉 특정 함수에서 사용하는 변수들이 함수 내부 스코프에 포함되어 있지 않더라도(참조하는 변수의 스코프가 종료되어도) 스코프를 생성하여 유지시킨다는 말입니다. 말로만 들어선 이해가 가지 않을 수 있습니다. 예제코드를 통해 클로저를 이해해 봅시다.</p>

<h2 id="클로저의-예">클로저의 예</h2>
<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">counter</span><span class="p">(){</span>
	<span class="kd">var</span> <span class="nx">count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">return</span> <span class="p">{</span>
		<span class="na">increase</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span> 
			<span class="k">return</span> <span class="o">++</span><span class="nx">count</span><span class="p">;</span>
		<span class="p">},</span>
		<span class="na">decrease</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
			<span class="k">return</span> <span class="o">--</span><span class="nx">count</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">};</span>
<span class="p">}</span>
<span class="kd">var</span> <span class="nx">counter</span> <span class="o">=</span> <span class="nx">counter</span><span class="p">();</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">counter</span><span class="p">.</span><span class="nx">increase</span><span class="p">());</span>  <span class="c1">//1</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">counter</span><span class="p">.</span><span class="nx">increase</span><span class="p">());</span>  <span class="c1">//2</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">counter</span><span class="p">.</span><span class="nx">decrease</span><span class="p">());</span>  <span class="c1">//1</span>

<span class="kd">var</span> <span class="nx">counter2</span> <span class="o">=</span> <span class="nx">counter</span><span class="p">();</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">counter2</span><span class="p">.</span><span class="nx">increase</span><span class="p">());</span> <span class="c1">//1</span>
</code></pre></div></div>
<p>counter함수를 살펴봅시다. 일단 내부에 count변수를 가지고 있습니다. 그리고 다시 하나의 오브젝트를 리턴하는데 <strong>중요한 점은 이 오브젝트에서 count변수를 사용한다는 것입니다(오브젝트의 내용이 함수라는 것도 상기합시다).</strong> 리턴된 오브젝트를 통해 increase함수와 decrease함수를 호출하는데 counter가 리턴을 하여 스코프가 소멸한것처럼 보이지만, 즉 지역변수인 count가 제거(정확하게 말하면 메모리를 다시 반환)된것 보이지만 실제 반환된 counter를 가지고 increase와 decrease를 실행해도 count를 가진것 처럼 동작됩니다. 이것이 클로저의 핵심입니다. 마치 count변수를 private변수처럼 사용하고 있죠. 또한 counter2를 만들어 사용하면 별도의 count를 가진것(실제로 별도의 스코프를 가지고 있음) 처럼 동작합니다. 
다음은 위 예제의 스코프 체인 구조입니다.
<img src="/public/js-closure.png" alt="" /></p>

<h2 id="클로저-실제-사용예제">클로저 실제 사용예제</h2>
<p>간단한 예제를 통해 클로저를 살펴봤는데 그래도 어디서 사용되는지 감을 잡기 어려울 수 있습니다. 이 의문에 직관적인 대답은 클로저를 가장 많이 사용하는 것은 자바스크립트 라이브러리 모듈에서 private로 변수를 보호하고 싶을때와 static변수를 사용하고 싶을때 사용한다는 것입니다. 또한 콜백함수 인자를 넘겨 넘긴 시점의 값을 유지하여 사용하고 싶을때 입니다. 
다음 예제를 보며 위 말이 무슨 뜻인지 살펴보겠습니다.  이 예제는 각 버튼을 클릭했을때 실행되는 작업이 다르도록 콜백을 설정하는 것입니다.</p>
<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"wrapper"</span><span class="nt">&gt;</span>
	<span class="nt">&lt;button</span> <span class="na">data-cb=</span><span class="s">"1"</span><span class="nt">&gt;</span>Add div<span class="nt">&lt;/button&gt;</span>
	<span class="nt">&lt;button</span> <span class="na">data-cb=</span><span class="s">"2"</span><span class="nt">&gt;</span>Add img<span class="nt">&lt;/button&gt;</span>
	<span class="nt">&lt;button</span> <span class="na">data-cb=</span><span class="s">"delete"</span><span class="nt">&gt;</span>Clear<span class="nt">&lt;/button&gt;</span>
	Adding below...<span class="nt">&lt;br/&gt;</span>
	<span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"appendDiv"</span><span class="nt">&gt;&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;script&gt;</span>
<span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
	<span class="kd">var</span> <span class="nx">appendDiv</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">"appendDiv"</span><span class="p">);</span>
	<span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">"wrapper"</span><span class="p">).</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">"click"</span><span class="p">,</span> <span class="nx">append</span><span class="p">);</span>

	<span class="kd">function</span> <span class="nx">append</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
		<span class="kd">var</span> <span class="nx">target</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span> <span class="o">||</span> <span class="nx">e</span><span class="p">.</span><span class="nx">srcElement</span> <span class="o">||</span> <span class="nx">event</span><span class="p">.</span><span class="nx">srcElement</span><span class="p">;</span>
		<span class="kd">var</span> <span class="nx">callbackFunction</span> <span class="o">=</span> <span class="nx">callback</span><span class="p">[</span><span class="nx">target</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="s2">"data-cb"</span><span class="p">)];</span>
		<span class="nx">appendDiv</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">callbackFunction</span><span class="p">());</span>
	<span class="p">};</span>
	<span class="kd">var</span> <span class="nx">callback</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s2">"1"</span><span class="p">:(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
			<span class="kd">var</span> <span class="nx">div</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">"div"</span><span class="p">);</span>
			<span class="nx">div</span><span class="p">.</span><span class="nx">h</span><span class="o">=</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="s2">"Adding new div"</span><span class="p">;</span>
			<span class="k">return</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
				<span class="k">return</span> <span class="nx">div</span><span class="p">.</span><span class="nx">cloneNode</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
			<span class="p">}</span>
		<span class="p">}()),</span>
		<span class="s2">"2"</span><span class="p">:(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
			<span class="kd">var</span> <span class="nx">img</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">"img"</span><span class="p">);</span>
			<span class="nx">img</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="s2">""</span><span class="p">;</span>
			<span class="k">return</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
				<span class="k">return</span> <span class="nx">img</span><span class="p">.</span><span class="nx">cloneNode</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
			<span class="p">}</span>
		<span class="p">}()),</span>
		<span class="s2">"delete"</span><span class="p">:</span> <span class="kd">function</span><span class="p">(){</span>
			<span class="nx">appendDiv</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="s2">""</span><span class="p">;</span>
			<span class="k">return</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createTextNode</span><span class="p">(</span><span class="s2">"Cleared"</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">};</span>
<span class="p">}());</span>
<span class="nt">&lt;/script&gt;</span>
</code></pre></div></div>

<p>이 예제에서 클로저를 활용하는 부분은 크게 두 부분입니다. 첫 번째는 appendDiv를 가져 오는 부분입니다. 이렇게 <strong>한 번 초기화</strong>되고 append 함수안에서 호출되고 있습니다. 두 번째는 callback 오브젝트의 각 요소들 입니다.  즉시 실행함수로 결과 함수를 리턴하는데 리턴되는 함수안에서 즉시실행함수의 div, img를 참조합니다. 마치 private처럼 숨기고 있고 첫 번째와 비슷하게 한번 초기화하고 계속 반복적으 접근하는 형식으로 사용되고 있습니다. 
이렇게 최초에 초기화된 고정적인 값이나 변수를 자주 이용하는 경우, 클로저를 통해 최초에 한번 초기화하고 콜백에서 반복적으로 참조하는 것이 퍼포먼스상 유리하게 작용할 수 있고, 객체의 수정이 쉽고 자유로운 자바스크립트에서는 좀 더 안정적인 사용을 유도하는 코드 스타일을 만들어내기 때문에 라이브러리를 개발할 때 자주 쓰이는 것입니다(물론 그 외의 장점도 있습니다).</p>

<h2 id="클로저-단점">클로저 단점</h2>
<p>그렇다면 클로저는 무조건 장점만 가지고 있을까요? 그건아닙니다. 클로저는 다음과 같은 단점을 가지고 있습니다.</p>

<ul>
  <li>클로저는 메모리를 소모한다.</li>
  <li>스코프 생성과 이후 변수 조회에 따른 퍼포먼스 손해가 있다.</li>
</ul>

<p>두 구문 모두 스코프와 관련되어 있을 수 있는데요, 소멸해야할 스코프들의 변수들이 메모리에 로드되어 있어야하기 때문에 메모리를 소모할 수 밖에 없습니다. 또한 변수를 참조할때 현재 스코프만 아닌, 변수가 없는경우 상위 스코프들을 탐색해서 변수의 존재여부를 판단하며 동작되기 때문입니다.</p>

<h2 id="결론">결론</h2>
<p>클로저는 자바스크립트에서 굉장히 중요한 요소입니다. 익숙해지지 않으면 사용하기 어렵지만 자바스크립트 개발자라면 정확하게 이해하고 사용가능해야합니다. 이를 위해서는 단점 또한 정확하게 파악하고 있어야 하며 여러 자바스크립트 라이브러리들을 분석하며 클로저가 어떻게 사용되고 있는지 분석 할 필요가 있습니다.</p>

<h2 id="references">References</h2>
<ul>
  <li><a href="http://www.kyobobook.co.kr/product/detailViewKor.laf?ejkGb=KOR&amp;mallGb=KOR&amp;barcode=9791186710098&amp;orderClick=LEA&amp;Kc=">속깊은 Javascript</a></li>
</ul>


  
  <div class="post-disqus">
      <section id="disqus_thread"></section>
      <div id="disqus_thread"></div>
<script>

/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
/*
var disqus_config = function () {
this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
*/
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = 'https://youngwonseo.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
                            
  </div>
  
</div>

<div class="pagination">
  
    <a href="/2018/12/05/03-global-variable-1/" class="left arrow">&#8592;</a>
  
  
    <a href="/2018/11/28/01-scope/" class="right arrow">&#8594;</a>
  

  <a href="#" class="top">Top</a>
</div>

    </main>

    <footer>
      <span>
        &copy; <time datetime="2019-08-26 15:08:27 +0900">2019</time> Youngwon Seo. Made with Jekyll using the <a href="https://github.com/chesterhow/tale/">Tale</a> theme.
      </span>
    </footer>
  </body>
</html>
