<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>
    
      자바스크립트 - 단일 스레드 &middot; Youngwon Seo
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/assets/main.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Libre+Baskerville:400,400i,700">

  <!-- Favicon -->
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon-16x16.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png">
</head>

  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-118401942-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-118401942-1');
</script>

  <body>
    <nav class="nav">
      <div class="nav-container">
        <a href="/">
          <h2 class="nav-title">Youngwon Seo</h2>
        </a>
        <ul>
          <li><a href="/about">About</a></li>
          <li><a href="/">Posts</a></li>
          <li><a href="/study"/>Study</a></li>
          <li><a href="/ml"/>Machine Learning</a></li>
          <li><a href="/people"/>People</a></li>
          <!-- <li><a href="/spring"/>Spring</a></li>
          <li><a href="/deeplearning"/>Deeplearning</a></li> -->
        </ul>
    </div>
  </nav>

    <main>
      <div class="post">
  <div class="post-info">
    <span>Written by</span>
    
        Youngwon Seo
    

    
      <br>
      <span>on&nbsp;</span><time datetime="2018-12-31 00:00:00 +0900">December 31, 2018</time>
    
  </div>

  <h1 class="post-title">자바스크립트 - 단일 스레드</h1>
  <div class="post-line"></div>

  <h1 id="단일-스레드">단일 스레드</h1>
<p>자바스크립트의 대표적인 특징가운데 한 가지는 단일 스레드에서 동작한다는 것입니다.</p>

<h2 id="settimeout과-setinterval">setTimeout과 setInterval</h2>
<p>여기서는 setTimeout과 setInterval을 이용해 단일스레드의 동작방식을 이해해 봅시다(html파일위에 자바스크립트코드가 입력되어있지만 html은 사용하지 않습니다) . 참고로 setTimeout은 첫 번째 인자인 콜백을 두 번째 인자인 밀리세컨드후 호출하는 함수이고 setInterval은 첫 번째 인자인 콜백을 두 번째 인자인 밀리세컨트마다 호출하는 함수입니다. 즉 setTimeout과 setInterval함수의 차이는 한 번 호출, 매 주기 호출이라고 생각할 수 있습니다. 다음은 예제입니다.</p>
<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html</span>  <span class="na">lang=</span><span class="s">"en"</span><span class="nt">&gt;</span>
	<span class="nt">&lt;head&gt;</span>
		<span class="nt">&lt;meta</span>  <span class="na">charset=</span><span class="s">"UTF-8"</span><span class="nt">&gt;</span>
		<span class="nt">&lt;meta</span>  <span class="na">name=</span><span class="s">"viewport"</span>  <span class="na">content=</span><span class="s">"width=device-width, initial-scale=1.0"</span><span class="nt">&gt;</span>
		<span class="nt">&lt;meta</span>  <span class="na">http-equiv=</span><span class="s">"X-UA-Compatible"</span>  <span class="na">content=</span><span class="s">"ie=edge"</span><span class="nt">&gt;</span>
		<span class="nt">&lt;title&gt;</span>Document<span class="nt">&lt;/title&gt;</span>
	<span class="nt">&lt;/head&gt;</span>
	<span class="nt">&lt;body&gt;</span>
		<span class="nt">&lt;script&gt;</span>
			<span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
				<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"start: </span><span class="err">\</span><span class="s2">t</span><span class="err">\</span><span class="s2">t</span><span class="err">\</span><span class="s2">t</span><span class="err">\</span><span class="s2">t</span><span class="err">\</span><span class="s2">t</span><span class="err">\</span><span class="s2">t</span><span class="err">\</span><span class="s2">t"</span> <span class="o">+</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">());</span>
				<span class="kd">var</span>  <span class="nx">intervalCount</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
				<span class="kd">var</span>  <span class="nx">intervalId</span> <span class="o">=</span> <span class="nx">setInterval</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
					<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"#"</span><span class="o">+</span><span class="nx">intervalCount</span><span class="o">+</span><span class="s2">" setInterval: </span><span class="err">\</span><span class="s2">t</span><span class="err">\</span><span class="s2">t</span><span class="err">\</span><span class="s2">t</span><span class="err">\</span><span class="s2">t"</span> <span class="o">+</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">());</span>
					<span class="k">if</span><span class="p">(</span><span class="o">++</span><span class="nx">intervalCount</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">){</span>
						<span class="nx">clearInterval</span><span class="p">(</span><span class="nx">intervalId</span><span class="p">);</span>
					<span class="p">}</span>
				<span class="p">},</span><span class="mi">2000</span><span class="p">);</span>

				<span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
					<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"setTimeout: </span><span class="err">\</span><span class="s2">t</span><span class="err">\</span><span class="s2">t</span><span class="err">\</span><span class="s2">t</span><span class="err">\</span><span class="s2">t</span><span class="err">\</span><span class="s2">t"</span> <span class="o">+</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">());</span>
					<span class="nx">sleep</span><span class="p">(</span><span class="mi">10000</span><span class="p">);</span>
				<span class="p">},</span><span class="mi">5000</span><span class="p">);</span>

				<span class="nx">sleep</span><span class="p">(</span><span class="mi">10000</span><span class="p">);</span>

				<span class="kd">function</span>  <span class="nx">sleep</span><span class="p">(</span><span class="nx">waitMilliseconds</span><span class="p">){</span>
					<span class="kd">var</span>  <span class="nx">waitUntil</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span> <span class="o">+</span> <span class="nx">waitMilliseconds</span><span class="p">;</span>
					<span class="k">while</span><span class="p">(</span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span> <span class="o">&lt;</span> <span class="nx">waitUntil</span><span class="p">){</span>
						<span class="p">;</span>
					<span class="p">}</span>
				<span class="p">}</span>
			<span class="p">}());</span>
		<span class="nt">&lt;/script&gt;</span>
	<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div>
<p>결과부터 살펴보며 코드를 이해해 봅시다. <strong>여기서 중요한 부분은 밀리세컨드가 표기된 시각부분입니다.</strong>
<img src="/public/js-single-thread-2.png" alt="" />
즉시실행함수의 실행흐름을 살펴보면 먼저 시작시간의 밀리세컨드를 출력합니다(Data.now()). 이후 setInterval과 setTimeout을 등록하는데 각각 2000, 5000 밀리세컨드 후 실행되도록 등록합니다.  여기까지만 살펴보면 사용자의 의도는 setInterval이 2초마다 실행되고 setTimeout이 5초후 한번 실행되기를 의도합니다. 또한 여기서 <strong>실행된다는 의미는 스레드 큐에 등록하는 것을 의미합니다. 스레드 큐에 등록되면 처음부터 하나씩 꺼내서 실행을 하게 되죠(FIFO).</strong> 하지만 의도와는 다르게 그 다음 코드에 sleep함수로 인해 실행되는 시간을 보장받을 수 없게 됩니다. 이유는 sleep에서 10초동안 루프를 돌게 됩니다. 이 루프를 도는 동안에는 스레드큐에 작업이 들어와도 실행을 하지 않습니다. 즉 큐에서 대기하고 있는 것이죠. 
10초후에는 sleep함수가 종료되고 스레드 큐에 있던 setInterval과 setTimeout이 실행이 됩니다. 이미 큐에 같이 들어가 있었으므로(setInterval은 인자가 2초 이므로 먼저 큐에 들어가있기 때문에 먼저 실행됩니다) 거의 동시에 실행되죠. 하지만 setTimeout의 콜백함수를 보면 sleep으로 10초를 대기합니다. 즉! setInterval의 주기인 2초가 지나도 setTimout의 콜백에 존재하는 sleep이 실행중입니다. 그러므로 다시 10초를 대기후 setInterval이 실행됩니다. 2초라는 주기와 상관없이 말이죠. 이제 10초후 setInterval이 실행되고 실행이 완료되면 다시 2초후 setInterval이 실행됩니다. 이번에는 sleep이 없었기 때문에 2초라는 시간이 제대로 지켜졌습니다. 
도식화된 그림을 보면 다음과 같습니다. 그림을 보고 다시 위의 설명을 보면 이해하기 수월합니다.
<img src="/public/js-single-thread-1.png" alt="" />
(파랑색은 실행 중인 작업, 빨간생은 생성된 작업)
여기서 우리는 setInterval의 특성을 한 가지 더 알수 있습니다. 그것은 setInterval의 콜백함수는 실행이 된 후, 즉 스레드 큐에서 호출되어 실행된 후 부터 다시 두 번째 인자만큼의 시간후 스레드 큐에 등록된다는 사실입니다. 
이 처럼 단일 스레드기반 자바스크립트에서는 스레드큐가 하나만 존재하여 스레드큐에 작업이 등록되도 다른작업으로 인해 실행시간이 지연될 수있는 특징을 가집니다. 이것은 setInterval과 setTimeout만이 아니라 비동기 또는 이벤트로 호출되는 모든 작업이 스레드큐에 등록된 후 자신의 차례가오면 실행된다는 특징을 보여줍니다.</p>

<h2 id="references">References</h2>
<ul>
  <li><a href="http://www.kyobobook.co.kr/product/detailViewKor.laf?ejkGb=KOR&amp;mallGb=KOR&amp;barcode=9791186710098&amp;orderClick=LEA&amp;Kc=">속 깊은 Javascript</a></li>
</ul>


  
  <div class="post-disqus">
      <section id="disqus_thread"></section>
      <div id="disqus_thread"></div>
<script>

/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
/*
var disqus_config = function () {
this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
*/
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = 'https://youngwonseo.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
                            
  </div>
  
</div>

<div class="pagination">
  
    <a href="/2019/01/01/2019-plan/" class="left arrow">&#8592;</a>
  
  
    <a href="/2018/12/27/08-design-pattern-2/" class="right arrow">&#8594;</a>
  

  <a href="#" class="top">Top</a>
</div>

    </main>

    <footer>
      <span>
        &copy; <time datetime="2019-04-26 11:28:03 +0900">2019</time> Youngwon Seo. Made with Jekyll using the <a href="https://github.com/chesterhow/tale/">Tale</a> theme.
      </span>
    </footer>
  </body>
</html>
